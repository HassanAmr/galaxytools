<tool id="odose" name="odose" version="0.1.0">
    <description>Ortholog Direction of Selection Engine</description>
    <requirements>
        <requirement type="package" version="1.0">odose</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        mkdir selected_genomes/ &&

        #for $ncbi_genome_selection in $ncbi_genome_selections
            #if str($ncbi_genome_selection) != "None":
                mv $ncbi_genome_selection selected_genomes/ &&
            #end if
        #end for

        #for $usergenerated_fasta in $usergenerated_fastas
            #if str($usergenerated_fasta) != "None":
                mv $usergenerated_fasta selected_genomes/ &&
            #end if
        #end for

        gzip selected_genomes/* &&
        ls -l selected_genomes/* > '$input_details' &&

        extract_orthologs 
        --genomes $genomes 
        --dna-zip $dnazip ##this should be the zip files/or 1 zip file of the selected genomes above
        --groups $groups
        #if str($outputmucozip) == "True":
            --muco-zip $mucozip
        #end if
        #if str($outputaccessoryzip) == "True":
            --subset-zip $accessoryzip
        #end if
        --sico-zip sicozip
        --stats stats
        --heatmap heatmap
        --orfans orfans >> logile &&

        align_trim_orthologs
        --orthologs-zip sicozip
        --retained-threshold $retainedthreshold
        --max-indel-length $maxindellength
        --aligned-zip alignedzip
        --misaligned-zip misalignedzip
        --trimmed-zip trimmedzip
        --stats stats
        --scatterplot scatterplot  >> logile 

        ## rest of the ODoSE pipeline

    ]]></command>
    <inputs>
        <param name="ncbi_genome_selections" type="data" multiple="true" optional="true" label="genome dataset" help="If your history does not contain the genome files, first run the genome downloader tool"/>
        <param type="data" name="usergenerated_fastas" multiple="true" format="fasta" optional="true" label="user generated fasta files" help="user generated fasta files"/>
        <param name="intertaxrec_filtering" type="select" label="Inter-Taxon Recombination Filtering">
            <option value="with_intertaxrec_filtering">With Inter-Taxon Recombination Filtering</option>
            <option value="without_intertaxrec_filtering">Without Inter-Taxon Recombination Filtering</option>
        </param>
        <param format="tsv" name="genomes" type="data" label="GenBank Project IDs" />
        <param format="tsv" name="groups" type="data" label="Orthologous groups" />
        <param name="outputmucozip" type="boolean" label="Output shared multiple-copy orthologous genes" />
        <param name="outputaccessoryzip" type="boolean" label="Output accessory orthologous genes" />
        <param name="retainedthreshold" type="integer" label="Minimum % retained after trimmining alignment" min="0" max="100" value="90" optional="false" help="Filter orthologs where less than a given percentage of sequence is retained after trimming alignment"/>
        <param name="maxindellength" type="integer" label="Maximum length of insertions and deletions in alignment" min="0" value="30" optional="false" help="Filter orthologs containing insertions or deletions longer than length (at the nucleic acids level)"/>
    </inputs>
    <outputs>
        <data format="tabular" name="input_details" label="zip file"/>
    </outputs>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>